Persona: intermediate
Date: 2026-01-19T21:24:34-07:00
Duration: 1m8.734s
Success: true
Score: 9/12

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
USER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Create an ARM template for a multi-tier enterprise application:

**Network:**
- Virtual network (10.0.0.0/16) with subnets for web and app tiers
- Network security groups with appropriate rules
- Public IP for load balancing

**Compute:**
- Web tier VMSS (2 instances) in web-subnet
- Application Gateway for internet-facing traffic

**Storage:**
- Storage account for application data

**Security:**
- NSG rules to restrict traffic between tiers

Location: East US

Generate a single ARM template JSON file with all resources.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ASSISTANT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

I'll create a comprehensive ARM template for your multi-tier enterprise application. Let me start by creating the necessary directory structure and then generate the ARM template.Now I'll generate the comprehensive ARM template with all the required resources:Perfect! I've created a comprehensive ARM template for your multi-tier enterprise application. Here's what's included:

## ğŸ“‹ Template Overview

### **Network Resources:**
- **Virtual Network** (10.0.0.0/16) with three subnets:
  - `web-subnet` (10.0.1.0/24) - for web tier VMSS
  - `app-subnet` (10.0.2.0/24) - for application tier (reserved for future use)
  - `agw-subnet` (10.0.3.0/24) - for Application Gateway

- **Network Security Groups** with security rules:
  - `web-nsg`: Allows HTTP/HTTPS only from Application Gateway subnet, denies direct Internet access
  - `app-nsg`: Allows traffic only from web tier on port 8080, denies all other inbound
  - `agw-nsg`: Allows HTTP/HTTPS from Internet and required infrastructure ports for Application Gateway

- **Public IP**: Standard SKU static IP with DNS label for the Application Gateway

### **Compute Resources:**
- **Virtual Machine Scale Set** (web-vmss):
  - 2 instances (configurable via parameter)
  - Ubuntu 18.04 LTS
  - Standard_D2s_v3 VMs (configurable)
  - Nginx installed via custom script extension
  - Connected to Application Gateway backend pool
  - Deployed in web-subnet

### **Application Gateway:**
- **Standard_v2** tier with 2 capacity units
- HTTP listener on port 80
- Health probe monitoring backend instances
- Backend pool connected to VMSS instances
- Request routing rules configured

### **Storage:**
- **Storage Account** with:
  - Standard_LRS redundancy
  - StorageV2 (general-purpose v2)
  - HTTPS-only traffic enforcement
  - TLS 1.2 minimum version
  - Encryption enabled for blob and file services
  - Globally unique name using `uniqueString()`

### **Security Features:**
âœ… Traffic isolation between tiers via NSG rules
âœ… No direct Internet access to web tier (only via Application Gateway)
âœ… App tier isolated to only accept traffic from web tier
âœ… HTTPS enforcement on storage
âœ… Encrypted storage at rest

## ğŸ“ Parameters

The template includes configurable parameters:
- `adminUsername`: VM admin username (default: azureuser)
- `adminPassword`: VM admin password (secure parameter)
- `vmSku`: VM size (default: Standard_D2s_v3)
- `instanceCount`: Number of VMSS instances (default: 2, range: 2-10)

## ğŸ“¤ Outputs

The template provides useful outputs:
- Application Gateway public IP address
- Application Gateway FQDN
- Storage account name and blob endpoint
- Virtual network ID
- VMSS name

## ğŸš€ Deployment

To deploy this template:

```bash
az group create --name enterprise-rg --location eastus

az deployment group create \
  --resource-group enterprise-rg \
  --template-file enterprise-template.json \
  --parameters adminPassword='YourSecurePassword123!'
```

The template file has been created at:
`/Users/alex/Documents/checkouts/wetwire-azure-go/examples/enterprise_scenario/results/intermediate/enterprise-template.json`
